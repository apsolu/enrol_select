/**
 * Module javascript.
 *
 * @todo       Description à compléter.
 *
 * @module     enrol_select/select_enrol
 * @copyright  2016 Université Rennes 2 <dsi-contact@univ-rennes2.fr>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("enrol_select/select_enrol",["jquery"],(function($){return{initialise:function(wwwroot){$("body").append('<div id="apsolu-enrol-form"></div>');var tooglebutton=document.getElementById("apsolu-toggle-activities");function set_edit_actions(){$("#apsolu-enrol-form #id_enrolbutton, #apsolu-enrol-form #id_unenrolbutton, #apsolu-enrol-form #id_editenrol").click((function(event){event.preventDefault();var role=$("#apsolu-enrol-form form select[name=role] option:selected").val();null==role&&(role=$("#apsolu-enrol-form form input[name=role]").val());var actions,enrolid=$("#apsolu-enrol-form form input[name=enrolid]").val(),sesskey=$("#apsolu-enrol-form form input[name=sesskey]").val();if("id_unenrolbutton"==$(this).attr("id"))actions={_qf__enrol_select_form:1,sesskey:sesskey,enrolid:enrolid,unenrolbutton:1};else if("id_editenrol"==$(this).attr("id"))actions={_qf__enrol_select_form:1,sesskey:sesskey,enrolid:enrolid,editenrol:1,policy:1};else{var fullname=$("#apsolu-enrol-form form input[name=fullname]").val(),federation=$("#apsolu-enrol-form form select[name=federation] option:selected").val();actions=federation?{fullname:fullname,enrolid:enrolid,role:role,federation:federation,enrolbutton:1,_qf__enrol_select_form:1,sesskey:sesskey,policy:1}:{fullname:fullname,enrolid:enrolid,role:role,enrolbutton:1,_qf__enrol_select_form:1,sesskey:sesskey,policy:1}}return $.ajax({url:wwwroot+"/enrol/select/ajax/enrol.php",type:"POST",data:actions,dataType:"html"}).done((function(result){try{var error=$.parseJSON(result);$("#apsolu-enrol-form").html('<div class="alert alert-danger"><p>'+error.error+"</p></div>")}catch(e){$("#apsolu-enrol-form").html(result)}})).always((function(){set_edit_actions(),set_cancel_actions(),set_policy_actions(),function(enrolid){$.ajax({url:wwwroot+"/enrol/select/ajax/reload_block_remaining.php",dataType:"html"}).done((function(result){$("#apsolu-select-remaining-ajax").html(result),$("#apsolu-rules-summary").css("display","none"),$("#apsolu-rules-summary_background, #apsolu-rules-summary_wrapper").remove(),$("#apsolu-rules-summary-a").click((function(evt){evt.preventDefault(),$("#apsolu-rules-summary").css({backgroundColor:"#EEEEEE",padding:".5em",cursor:"default",maxWidth:"50%"}),$("#apsolu-rules-summary").popup("show")}))})).fail((function(){})),$.ajax({url:wwwroot+"/enrol/select/ajax/reload_block_enrolments.php",dataType:"html"}).done((function(result){$("#apsolu-select-enrolments-ajax").html(result)})).fail((function(){})),$.ajax({url:wwwroot+"/enrol/select/ajax/reload_column_left_places.php",type:"POST",data:{enrolid:enrolid},dataType:"html"}).done((function(result){$("#apsolu-select-left-places-"+enrolid+"-ajax").replaceWith(result)})).fail((function(){}));var img_src=$(".apsolu-enrol-a[data-enrolid="+enrolid+"] img").attr("src");$(".apsolu-enrol-a[data-enrolid="+enrolid+"]").hasClass("apsolu-enroled-a")?($(".apsolu-enrol-a[data-enrolid="+enrolid+"]").removeClass("apsolu-enroled-a"),$(".apsolu-enrol-a[data-enrolid="+enrolid+"]").addClass("apsolu-not-enroled-a"),$(".apsolu-enrol-a[data-enrolid="+enrolid+"]").parent().parent().removeClass("info"),$(".apsolu-enrol-a[data-enrolid="+enrolid+"] img").attr("src",img_src.replace("i/completion-manual-y","i/completion-manual-n"))):($(".apsolu-enrol-a[data-enrolid="+enrolid+"]").removeClass("apsolu-not-enroled-a"),$(".apsolu-enrol-a[data-enrolid="+enrolid+"]").addClass("apsolu-enroled-a"),$(".apsolu-enrol-a[data-enrolid="+enrolid+"]").parent().parent().addClass("info"),$(".apsolu-enrol-a[data-enrolid="+enrolid+"] img").attr("src",img_src.replace("i/completion-manual-n","i/completion-manual-y")))}(enrolid)})),!1}))}function set_cancel_actions(){$(".apsolu-cancel-a").click((function(event){event.preventDefault(),$("#apsolu-enrol-form").popup("hide")}))}function set_policy_actions(){var policy=$("#apsolu-enrol-form form input[name=policy]");policy.length&&($("#apsolu-enrol-form form input[name=enrolbutton]").prop("disabled",!0),policy.change((function(){$(this).is(":checked")?$("#apsolu-enrol-form form input[name=enrolbutton]").prop("disabled",!1):$("#apsolu-enrol-form form input[name=enrolbutton]").prop("disabled",!0)})))}tooglebutton&&tooglebutton.addEventListener("click",(function(evt){var i=0,display="",action=evt.currentTarget.getAttribute("data-action");switch(action){case"show":display="table-row",action="hide";break;case"hide":display="none",action="show"}var rows=document.querySelectorAll("#apsolu-activities-table tbody tr");for(i=0;i<rows.length;i++)rows[i].style.display=display;for(rows=document.getElementsByClassName("apsolu-sports-tr"),i=0;i<rows.length;i++)rows[i].style.display="table-row";evt.currentTarget.setAttribute("data-action",action)})),$(".apsolu-enrol-a").click((function(event){event.preventDefault();var requesturl=$(this).attr("href");return requesturl=requesturl.replace("/enrol/select/overview/enrol.php","/enrol/select/ajax/enrol.php"),$.ajax({url:requesturl,type:"GET",dataType:"html"}).done((function(result){try{var error=$.parseJSON(result);$("#apsolu-enrol-form").html('<div class="alert alert-danger"><p>'+error.error+"</p></div>")}catch(e){$("#apsolu-enrol-form").html(result)}})).always((function(){set_edit_actions(),set_cancel_actions(),set_policy_actions(),$("#apsolu-enrol-form").popup("show")})),!1}))}}}));

//# sourceMappingURL=select_enrol.min.js.map