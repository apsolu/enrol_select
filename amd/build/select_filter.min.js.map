{"version":3,"file":"select_filter.min.js","sources":["../src/select_filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module javascript.\n *\n * @todo       Description à compléter.\n *\n * @module     enrol_select/select_filter\n * @copyright  2016 Université Rennes 2 <dsi-contact@univ-rennes2.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'enrol_select/select2'], function($) {\n    return {\n        initialise: function() {\n\n            /**\n             * Fonction appelée pour filtrer le tableau en fonction des filtres utilisés.\n             */\n            function apsolu_filter() {\n                var rows = $(\"#apsolu-activities-table tbody tr\");\n\n                rows.css(\"display\", \"table-row\");\n\n                var selections = $(\"#apsolu-wishes-filters .select2-selection__clear\");\n\n                if (selections.length != 0) {\n                    rows.each(function() {\n                        var row = $(this);\n                        var match = true;\n\n                        // Pour chaque filtre.\n                        selections.each(function() {\n                            if (match == false) {\n                                return;\n                            }\n\n                            var found = false;\n                            var choices = $(this).parent().find(\".select2-selection__choice\");\n\n                            // Pour chaque valeur de filtres.\n                            choices.each(function() {\n                                if (found == false) {\n                                    var text = $(this).attr(\"title\");\n                                    var colname = $(this).parents(\":eq(3)\").prev().attr(\"data-column-name\");\n                                    var th = $('#apsolu-activities-table th[data-column=' + colname + ']');\n                                    var colnum = $(\"#apsolu-activities-table tr th\").index(th);\n\n                                    if (row.children().length >= colnum) {\n                                        if (colname == 'role') {\n                                            found = row.children().eq(colnum).html().indexOf(text) > -1;\n                                        } else if (colname == 'starttime' || colname == 'endtime') {\n                                            found = row.children().eq(colnum).text().substr(0, 3) == text.substr(0, 2) + ':';\n                                        } else if (colname == 'sport' || colname == 'location') {\n                                            found = row.children().eq(colnum).children().eq(0).text() == text;\n                                        } else {\n                                            found = row.children().eq(colnum).text() == text;\n                                        }\n                                    }\n                                }\n                            });\n\n                            if (found == false) {\n                                match = false;\n                            }\n                        });\n\n                        if (match == false) {\n                            $(this).css(\"display\", \"none\");\n                        }\n                    });\n                } else {\n                    $(\"#apsolu-activities-table tbody tr th\").each(function() {\n                        $(this).css(\"display\", \"table-cell\");\n\n                        if ($(this).hasClass(\"apsolu-expandable\")) {\n                            $(this).parent().nextUntil(\".apsolu-sports-tr\").css(\"display\", \"none\");\n                        } else {\n                            $(this).parent().nextUntil(\".apsolu-sports-tr\").css(\"display\", \"table-row\");\n                        }\n                    });\n                }\n            }\n\n            /**\n             * Masque toutes les lignes du tableau contenant un créneau, pour ne garder que le sport.\n             */\n            function apsolu_collapse_rows() {\n                $('.apsolu-sports-th').children('span').attr(\"class\", \"apsolu-expandable\");\n                $('.apsolu-sports-th').parent().nextUntil(\".apsolu-sports-tr\").css(\"display\", \"none\");\n            }\n\n            $('.filters').each(function() {\n                $(this).select2({width: '100%'});\n\n                $(this).on('change.select2', function() {\n                    apsolu_filter();\n                });\n            });\n\n            $('#filters-submit, .apsolu-categories-col').css('display', 'none');\n            apsolu_filter();\n\n            $('#filters-reset').click(function() {\n                $('.filters').select2('val', '');\n                apsolu_filter();\n\n                apsolu_collapse_rows();\n            });\n        }\n    };\n});\n"],"names":["define","$","initialise","apsolu_filter","rows","css","selections","length","each","row","this","match","found","parent","find","text","attr","colname","parents","prev","th","colnum","index","children","eq","html","indexOf","substr","hasClass","nextUntil","select2","width","on","click"],"mappings":";;;;;;;;;AAyBAA,oCAAO,CAAC,SAAU,yBAAyB,SAASC,SACzC,CACHC,WAAY,oBAKCC,oBACDC,KAAOH,EAAE,qCAEbG,KAAKC,IAAI,UAAW,iBAEhBC,WAAaL,EAAE,oDAEM,GAArBK,WAAWC,OACXH,KAAKI,MAAK,eACFC,IAAMR,EAAES,MACRC,OAAQ,EAGZL,WAAWE,MAAK,cACC,GAATG,WAIAC,OAAQ,EACEX,EAAES,MAAMG,SAASC,KAAK,8BAG5BN,MAAK,cACI,GAATI,MAAgB,KACZG,KAAOd,EAAES,MAAMM,KAAK,SACpBC,QAAUhB,EAAES,MAAMQ,QAAQ,UAAUC,OAAOH,KAAK,oBAChDI,GAAKnB,EAAE,2CAA6CgB,QAAU,KAC9DI,OAASpB,EAAE,kCAAkCqB,MAAMF,IAEnDX,IAAIc,WAAWhB,QAAUc,SAErBT,MADW,QAAXK,QACQR,IAAIc,WAAWC,GAAGH,QAAQI,OAAOC,QAAQX,OAAS,EACxC,aAAXE,SAAqC,WAAXA,QACzBR,IAAIc,WAAWC,GAAGH,QAAQN,OAAOY,OAAO,EAAG,IAAMZ,KAAKY,OAAO,EAAG,GAAK,IAC3D,SAAXV,SAAiC,YAAXA,QACrBR,IAAIc,WAAWC,GAAGH,QAAQE,WAAWC,GAAG,GAAGT,QAAUA,KAErDN,IAAIc,WAAWC,GAAGH,QAAQN,QAAUA,UAM/C,GAATH,QACAD,OAAQ,OAIH,GAATA,OACAV,EAAES,MAAML,IAAI,UAAW,WAI/BJ,EAAE,wCAAwCO,MAAK,WAC3CP,EAAES,MAAML,IAAI,UAAW,cAEnBJ,EAAES,MAAMkB,SAAS,qBACjB3B,EAAES,MAAMG,SAASgB,UAAU,qBAAqBxB,IAAI,UAAW,QAE/DJ,EAAES,MAAMG,SAASgB,UAAU,qBAAqBxB,IAAI,UAAW,gBAc/EJ,EAAE,YAAYO,MAAK,WACfP,EAAES,MAAMoB,QAAQ,CAACC,MAAO,SAExB9B,EAAES,MAAMsB,GAAG,kBAAkB,WACzB7B,sBAIRF,EAAE,2CAA2CI,IAAI,UAAW,QAC5DF,gBAEAF,EAAE,kBAAkBgC,OAAM,WACtBhC,EAAE,YAAY6B,QAAQ,MAAO,IAC7B3B,gBAjBAF,EAAE,qBAAqBsB,SAAS,QAAQP,KAAK,QAAS,qBACtDf,EAAE,qBAAqBY,SAASgB,UAAU,qBAAqBxB,IAAI,UAAW"}