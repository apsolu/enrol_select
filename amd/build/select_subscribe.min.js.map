{"version":3,"file":"select_subscribe.min.js","sources":["../src/select_subscribe.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module javascript.\n *\n * @todo       Description à compléter.\n *\n * @module     enrol_select/select_subscribe\n * @copyright  2016 Université Rennes 2 <dsi-contact@univ-rennes2.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'enrol_select/notify'], function($) {\n    return {\n        initialise: function(wwwroot) {\n            $(\"input[name='enrolin']\").css(\"display\", \"none\");\n\n            $(\"select[name=roleid]\").change(function() {\n                // Get form values.\n                var courseid = $(this).attr('id').substring(9);\n                var roleid = $(this).children('option:selected')[0].value;\n                var enrolid = $(this).parent().find(\"input[name='enrolid']\")[0].value;\n\n                // Set 'apsolu-loading' css class to information cell.\n                var information = $(this).parent().parent().next(\".apsolu-activities-information-td\");\n                information.addClass('apsolu-loading');\n\n                var main_list = $(this).parent().parent().next().next(\".apsolu-activities-main-list-td\");\n\n                var wait_list = $(this).parent().parent().next().next().next(\".apsolu-activities-wait-list-td\");\n\n                $.ajax(\n                    {\n                        url: wwwroot + \"/enrol/select/ajax/subscribe.php\",\n                        type: 'POST',\n                        data: {courseid: courseid, roleid: roleid, enrolid: enrolid},\n                        dataType: 'json'\n                    })\n                    .done(function(result) {\n                        switch (result.status_code) {\n                            case \"0\":\n                                $.notify(result.message, \"success\");\n                                break;\n                            case \"1\":\n                                $.notify(result.message, \"warn\");\n                                break;\n                            case \"2\":\n                                $.notify(result.message, \"error\");\n                                break;\n                        }\n\n                        $('.notifyjs-corner').css('top', '50px');\n\n                        main_list.text(result.main_list);\n                        wait_list.text(result.wait_list);\n\n                        $(\"#apsolu-wishes-div\").remove();\n                        $(\"#apsolu-filters-div\").prepend(result.wishes_tpl);\n                    })\n                    .fail(function() {\n                        $.notify(\"Une erreur est survenue.\", \"error\");\n                        $('.notifyjs-corner').css('top', '50px');\n                    })\n                    .always(function() {\n                        information.removeClass('apsolu-loading');\n                    });\n            });\n        }\n    };\n});\n"],"names":["define","$","initialise","wwwroot","css","change","courseid","this","attr","substring","roleid","children","value","enrolid","parent","find","information","next","addClass","main_list","wait_list","ajax","url","type","data","dataType","done","result","status_code","notify","message","text","remove","prepend","wishes_tpl","fail","always","removeClass"],"mappings":";;;;;;;;;AAyBAA,uCAAO,CAAC,SAAU,wBAAwB,SAASC,SACxC,CACHC,WAAY,SAASC,SACjBF,EAAE,yBAAyBG,IAAI,UAAW,QAE1CH,EAAE,uBAAuBI,QAAO,eAExBC,SAAWL,EAAEM,MAAMC,KAAK,MAAMC,UAAU,GACxCC,OAAST,EAAEM,MAAMI,SAAS,mBAAmB,GAAGC,MAChDC,QAAUZ,EAAEM,MAAMO,SAASC,KAAK,yBAAyB,GAAGH,MAG5DI,YAAcf,EAAEM,MAAMO,SAASA,SAASG,KAAK,qCACjDD,YAAYE,SAAS,sBAEjBC,UAAYlB,EAAEM,MAAMO,SAASA,SAASG,OAAOA,KAAK,mCAElDG,UAAYnB,EAAEM,MAAMO,SAASA,SAASG,OAAOA,OAAOA,KAAK,mCAE7DhB,EAAEoB,KACE,CACIC,IAAKnB,QAAU,mCACfoB,KAAM,OACNC,KAAM,CAAClB,SAAUA,SAAUI,OAAQA,OAAQG,QAASA,SACpDY,SAAU,SAEbC,MAAK,SAASC,eACHA,OAAOC,iBACN,IACD3B,EAAE4B,OAAOF,OAAOG,QAAS,qBAExB,IACD7B,EAAE4B,OAAOF,OAAOG,QAAS,kBAExB,IACD7B,EAAE4B,OAAOF,OAAOG,QAAS,SAIjC7B,EAAE,oBAAoBG,IAAI,MAAO,QAEjCe,UAAUY,KAAKJ,OAAOR,WACtBC,UAAUW,KAAKJ,OAAOP,WAEtBnB,EAAE,sBAAsB+B,SACxB/B,EAAE,uBAAuBgC,QAAQN,OAAOO,eAE3CC,MAAK,WACFlC,EAAE4B,OAAO,2BAA4B,SACrC5B,EAAE,oBAAoBG,IAAI,MAAO,WAEpCgC,QAAO,WACJpB,YAAYqB,YAAY"}